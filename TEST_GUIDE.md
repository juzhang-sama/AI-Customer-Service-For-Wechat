# 🧪 测试指南

## 📋 启动步骤

### 1. 启动服务（一键启动）

**推荐方式：一键启动**
```bash
双击运行: start_servers.bat
```

这个脚本会自动：
- 启动后端服务
- 启动前端服务
- 打开浏览器

**手动启动（可选）**
```bash
# 方式一：单独启动
双击: start_backend.bat
双击: start_frontend.bat

# 方式二：命令行
cd c:\Users\wzj\Desktop\liandao
.venv\Scripts\activate
python python\api_server.py
```

**预期输出**:
```
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.x.x:5000
[监听器] 全局监听关键词: '客户'
[监听器] 微信监听器已启动
```

---

## 🧪 测试清单

### ✅ 测试 1: 首页关键词设置

1. 打开浏览器访问: http://localhost:5173
2. 查看首页顶部是否显示"全局监听关键词"卡片
3. 当前关键词应该显示为: `客户`
4. 点击"修改"按钮
5. 输入新的关键词，例如: `测试`
6. 点击"保存"
7. 应该显示绿色成功提示: "保存成功！请重启后端服务以生效。"

**预期结果**: ✅ 配置保存成功

---

### ✅ 测试 2: 重启后端验证关键词

1. 运行 `stop_servers.bat` 停止所有服务
2. 重新运行 `start_servers.bat`
3. 查看后端窗口的启动日志，应该显示:
   ```
   [监听器] 全局监听关键词: '测试'
   ```

**预期结果**: ✅ 关键词已更新

---

### ✅ 测试 3: 微信联系人监听测试

#### 准备工作
1. 打开微信
2. 找一个测试联系人
3. 将联系人备注改为: `测试-张三`

#### 测试步骤
1. 给"测试-张三"发送一条消息: "你好"
2. 等待 1-2 秒
3. 查看前端"消息中心"
4. 应该看到新消息出现

**预期结果**: ✅ 消息成功监听并显示

#### 对比测试
1. 找另一个联系人，备注为: `李四` (不以"测试"开头)
2. 给"李四"发送消息: "你好"
3. 查看前端"消息中心"
4. 应该**不会**显示这条消息

**预期结果**: ✅ 未匹配关键词的联系人不被监听

---

### ✅ 测试 4: AI 专家选择功能

#### 前提条件
- 已经创建至少 2 个 AI 专家配置

#### 测试步骤
1. 在"消息中心"点击某个会话
2. 查看右侧"AI 智能回复"面板
3. 应该看到"选择 AI 专家"下拉菜单
4. 下拉菜单中应该显示所有 AI 专家配置
5. 选择一个 AI 专家
6. 点击"生成回复"
7. 查看生成的回复是否符合所选专家的风格

**预期结果**: ✅ 可以自由选择 AI 专家

---

### ✅ 测试 5: 默认 AI 专家

#### 测试步骤
1. 不选择任何 AI 专家（下拉菜单保持"使用默认配置"）
2. 点击"生成回复"
3. 应该使用激活的 AI 专家配置

**预期结果**: ✅ 默认使用激活的配置

---

## 🐛 常见问题排查

### 问题 1: 后端启动失败

**症状**: 
```
ModuleNotFoundError: No module named 'flask'
```

**解决方案**:
```bash
# 确保虚拟环境已激活
.venv\Scripts\activate

# 重新安装依赖
pip install -r requirements.txt
```

---

### 问题 2: 前端无法连接后端

**症状**: 
- 前端显示"网络错误，请检查后端服务"
- 浏览器控制台显示 CORS 错误

**解决方案**:
1. 检查后端是否正在运行
2. 访问 http://localhost:5000/api/ai/config 测试
3. 检查防火墙设置

---

### 问题 3: 消息监听不工作

**症状**: 
- 微信有新消息，但前端不显示

**检查清单**:
- [ ] 后端是否正在运行？
- [ ] 联系人名称是否以关键词开头？
- [ ] 关键词是否正确（区分大小写）？
- [ ] 微信窗口是否打开？
- [ ] 查看后端日志是否有错误

**调试方法**:
```bash
# 查看后端日志
# 应该看到类似输出:
[监听器] 扫描到会话: 测试-张三
[监听器] 推送消息: {...}
```

---

### 问题 4: AI 专家下拉菜单为空

**症状**: 
- "选择 AI 专家"下拉菜单只有"使用默认配置"

**解决方案**:
1. 进入"AI 专家搭建"页面
2. 创建至少一个 AI 专家配置
3. 刷新页面

---

## 📊 测试数据示例

### 测试联系人命名

| 联系人备注 | 是否监听 | 说明 |
|-----------|---------|------|
| 客户-张三 | ✅ | 以"客户"开头 |
| 客户-李四-热玛吉 | ✅ | 以"客户"开头 |
| 客户ABC | ✅ | 以"客户"开头 |
| 张三 | ❌ | 不以"客户"开头 |
| 代理-王五 | ❌ | 不以"客户"开头 |
| 员工-赵六 | ❌ | 不以"客户"开头 |

### 测试消息

```
客户: 你好
客户: 我想了解一下热玛吉
客户: 价格多少？
客户: 有点贵啊
客户: 能便宜点吗？
```

---

## ✅ 测试完成标准

所有以下测试都通过，即可认为系统正常工作：

- [x] 首页可以修改监听关键词
- [x] 修改后重启生效
- [x] 只监听匹配关键词的联系人
- [x] 不监听不匹配的联系人
- [x] 可以选择 AI 专家
- [x] 默认使用激活的 AI 专家
- [x] 生成的回复符合所选专家风格

---

## 📝 测试记录

请在测试时记录以下信息：

**测试时间**: _______________

**测试环境**:
- 操作系统: Windows 11
- Python 版本: _______________
- Node.js 版本: _______________

**测试结果**:

| 测试项 | 结果 | 备注 |
|-------|------|------|
| 首页关键词设置 | ☐ 通过 ☐ 失败 | |
| 重启后端验证 | ☐ 通过 ☐ 失败 | |
| 微信监听测试 | ☐ 通过 ☐ 失败 | |
| AI 专家选择 | ☐ 通过 ☐ 失败 | |
| 默认 AI 专家 | ☐ 通过 ☐ 失败 | |

**发现的问题**:
1. _______________
2. _______________
3. _______________

---

**祝测试顺利！** 🎉

