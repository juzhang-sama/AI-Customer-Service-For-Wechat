# ğŸ“Š è”é“ AI åŠ©æ‰‹ - é¡¹ç›®æ•´ä½“åˆ†ææŠ¥å‘Š

## ğŸ“Œ é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**: dt-ai-helper (è”é“ AI åŠ©æ‰‹)
**é¡¹ç›®ç±»å‹**: å¾®ä¿¡æ¡Œé¢è‡ªåŠ¨åŒ– + AI æ™ºèƒ½å›å¤ç³»ç»Ÿ
**æŠ€æœ¯æ ˆ**: Electron + React + TypeScript + Python Flask
**ç›®æ ‡ç”¨æˆ·**: éœ€è¦é«˜æ•ˆç®¡ç†å¾®ä¿¡å®¢æˆ·æ²Ÿé€šçš„é”€å”®äººå‘˜

---

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å‰ç«¯ (React + TypeScript)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Dashboard  â”‚  â”‚ AIExpert   â”‚  â”‚   MessageCenter     â”‚  â”‚
â”‚  â”‚  (é¦–é¡µ)     â”‚  â”‚ Config     â”‚  â”‚   (æ¶ˆæ¯ä¸­å¿ƒ)        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ HTTP/SSE
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åç«¯ (Python Flask)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ api_server  â”‚  â”‚ ai_expert   â”‚  â”‚ message_listener    â”‚  â”‚
â”‚  â”‚ (ä¸»æœåŠ¡)    â”‚  â”‚ _api        â”‚  â”‚ (æ¶ˆæ¯ç›‘å¬)          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ UI Automation
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¾®ä¿¡å®¢æˆ·ç«¯ (Windows)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ä¼šè¯åˆ—è¡¨   â”‚  â”‚  èŠå¤©çª—å£   â”‚  â”‚   è”ç³»äººä¿¡æ¯        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ ç›®å½•ç»“æ„åˆ†æ

### æ ¸å¿ƒç›®å½•

```
liandao/
â”œâ”€â”€ src/                    # å‰ç«¯æºç  (React + TypeScript)
â”‚   â”œâ”€â”€ components/         # UI ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ AIExpert/       # AI ä¸“å®¶ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ layout/         # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ MessageCenter.tsx
â”‚   â”‚   â”œâ”€â”€ MessageSend.tsx
â”‚   â”‚   â”œâ”€â”€ ContactList.tsx
â”‚   â”‚   â””â”€â”€ Settings.tsx
â”‚   â”œâ”€â”€ pages/              # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Dashboard.tsx   # é¦–é¡µ
â”‚   â”‚   â””â”€â”€ AIExpertConfig.tsx
â”‚   â””â”€â”€ App.tsx             # ä¸»åº”ç”¨
â”‚
â”œâ”€â”€ python/                 # åç«¯æºç  (Python)
â”‚   â”œâ”€â”€ api_server.py       # Flask ä¸»æœåŠ¡
â”‚   â”œâ”€â”€ ai_expert_api.py    # AI ä¸“å®¶ API
â”‚   â”œâ”€â”€ message_listener.py # æ¶ˆæ¯ç›‘å¬å™¨
â”‚   â”œâ”€â”€ wechat_auto.py      # å¾®ä¿¡è‡ªåŠ¨åŒ–
â”‚   â””â”€â”€ ai_expert/          # AI ä¸“å®¶æ¨¡å—
â”‚       â”œâ”€â”€ database.py
â”‚       â”œâ”€â”€ reply_generator.py
â”‚       â”œâ”€â”€ prompt_builder.py
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ config/                 # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ ai_config.json      # AI é…ç½®
â”‚
â”œâ”€â”€ electron/               # Electron ä¸»è¿›ç¨‹
â”‚   â”œâ”€â”€ main.ts
â”‚   â””â”€â”€ preload.ts
â”‚
â””â”€â”€ å¯åŠ¨è„šæœ¬
    â”œâ”€â”€ start_servers.bat   # ä¸€é”®å¯åŠ¨
    â”œâ”€â”€ stop_servers.bat    # åœæ­¢æœåŠ¡
    â””â”€â”€ ...
```

---

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. æ¶ˆæ¯ç›‘å¬æ¨¡å— (`message_listener.py`)

**åŠŸèƒ½**: å®æ—¶ç›‘å¬å¾®ä¿¡ä¼šè¯åˆ—è¡¨ï¼Œæ•è·æ–°æ¶ˆæ¯

**å·¥ä½œåŸç†**:
- ä½¿ç”¨ `uiautomation` åº“æ‰«æå¾®ä¿¡çª—å£
- æ¯ 0.5 ç§’æ‰«æä¸€æ¬¡ä¼šè¯åˆ—è¡¨
- è§£æä¼šè¯åç§°ï¼Œæå–æ˜µç§°ã€æ¶ˆæ¯å†…å®¹ã€æ—¶é—´
- é€šè¿‡å…¨å±€å…³é”®è¯è¿‡æ»¤ï¼ˆåªç›‘å¬ä»¥å…³é”®è¯å¼€å¤´çš„è”ç³»äººï¼‰
- é€šè¿‡å›è°ƒå‡½æ•°æ¨é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—

**å…³é”®ä»£ç **:
```python
# å…¨å±€å…³é”®è¯è¿‡æ»¤
if not nickname.startswith(self.monitor_keyword):
    continue  # è·³è¿‡ä¸åŒ¹é…çš„è”ç³»äºº
```

### 2. AI ä¸“å®¶æ¨¡å— (`ai_expert/`)

**åŠŸèƒ½**: åŸºäºé…ç½®ç”Ÿæˆæ™ºèƒ½å›å¤å»ºè®®

**å­æ¨¡å—**:
| æ¨¡å— | åŠŸèƒ½ |
|------|------|
| `database.py` | SQLite æ•°æ®åº“ç®¡ç† |
| `prompt_builder.py` | æ„å»º System Prompt |
| `reply_generator.py` | è°ƒç”¨ DeepSeek API ç”Ÿæˆå›å¤ |
| `enhanced_reply_generator.py` | å¢å¼ºç‰ˆå›å¤ç”Ÿæˆå™¨ |
| `intent_recognizer.py` | å®¢æˆ·æ„å›¾è¯†åˆ« |
| `customer_memory.py` | å®¢æˆ·è®°å¿†ç®¡ç† |
| `conversation_stage_manager.py` | å¯¹è¯é˜¶æ®µç®¡ç† |
| `feedback_learner.py` | åé¦ˆå­¦ä¹  |
| `cost_calculator.py` | æˆæœ¬è®¡ç®— |

### 3. å¾®ä¿¡è‡ªåŠ¨åŒ–æ¨¡å— (`wechat_auto.py`)

**åŠŸèƒ½**: è‡ªåŠ¨å‘é€å¾®ä¿¡æ¶ˆæ¯

**å·¥ä½œåŸç†**:
- ä½¿ç”¨ `uiautomation` å®šä½å¾®ä¿¡çª—å£
- é€šè¿‡æœç´¢æ¡†æŸ¥æ‰¾è”ç³»äºº
- ä½¿ç”¨å‰ªè´´æ¿ç²˜è´´æ¶ˆæ¯å†…å®¹
- æ¨¡æ‹ŸæŒ‰é”®å‘é€æ¶ˆæ¯

### 4. å‰ç«¯æ¶ˆæ¯ä¸­å¿ƒ (`MessageCenter.tsx`)

**åŠŸèƒ½**: æ˜¾ç¤ºå’Œç®¡ç†å¾®ä¿¡ä¼šè¯

**ç‰¹æ€§**:
- SSE å®æ—¶æ¥æ”¶æ¶ˆæ¯
- ä¼šè¯åˆ—è¡¨åˆ†ç»„æ˜¾ç¤º
- æ¶ˆæ¯å†å²è®°å½•
- é›†æˆ AI å›å¤ç”Ÿæˆå™¨
- æœ¬åœ°å­˜å‚¨ä¼šè¯æ•°æ®

---

## ğŸ“Š æ•°æ®æµåˆ†æ

### æ¶ˆæ¯ç›‘å¬æµç¨‹

```
å¾®ä¿¡çª—å£
    â”‚
    â–¼ (UI Automation æ‰«æ)
message_listener.py
    â”‚
    â”œâ”€ è§£æä¼šè¯åç§°
    â”œâ”€ å…³é”®è¯è¿‡æ»¤
    â”œâ”€ çŠ¶æ€å¯¹æ¯”ï¼ˆæ£€æµ‹æ–°æ¶ˆæ¯ï¼‰
    â”‚
    â–¼ (å›è°ƒå‡½æ•°)
api_server.py (message_queue)
    â”‚
    â–¼ (SSE æ¨é€)
MessageCenter.tsx
    â”‚
    â–¼ (çŠ¶æ€æ›´æ–°)
UI æ˜¾ç¤º
```

### AI å›å¤ç”Ÿæˆæµç¨‹

```
ç”¨æˆ·ç‚¹å‡»"ç”Ÿæˆå›å¤"
    â”‚
    â–¼
InlineReplyGenerator.tsx
    â”‚
    â”œâ”€ è·å–å®¢æˆ·æ¶ˆæ¯
    â”œâ”€ é€‰æ‹© AI ä¸“å®¶
    â”‚
    â–¼ (POST /api/ai/generate)
ai_expert_api.py
    â”‚
    â”œâ”€ åŠ è½½ AI ä¸“å®¶é…ç½®
    â”œâ”€ æ„å»º System Prompt
    â”‚
    â–¼
reply_generator.py
    â”‚
    â”œâ”€ è°ƒç”¨ DeepSeek API
    â”œâ”€ ç”Ÿæˆ 3 ä¸ªç‰ˆæœ¬å›å¤
    â”‚
    â–¼
è¿”å›å‰ç«¯æ˜¾ç¤º
```

---

## ğŸ—„ï¸ æ•°æ®åº“ç»“æ„

### SQLite æ•°æ®åº“ (`ai_expert.db`)

**ä¸»è¦è¡¨**:

1. **prompts** - AI ä¸“å®¶é…ç½®
   - id, name, role_definition, business_logic
   - tone_style, reply_length, emoji_usage
   - knowledge_base, forbidden_words
   - system_prompt, is_active

2. **keyword_rules** - å…³é”®è¯è§„åˆ™ï¼ˆå·²åºŸå¼ƒï¼‰
   - id, prompt_id, keyword

3. **preset_qa** - é¢„è®¾é—®ç­”
   - id, prompt_id, question, answer

4. **customer_memory** - å®¢æˆ·è®°å¿†
   - customer_id, stage, interests, concerns
   - provided_info, interaction_count

5. **feedback_records** - åé¦ˆè®°å½•
   - session_id, version_selected, original_reply
   - modified_reply, timestamp

---

## ğŸ“ˆ é¡¹ç›®çŠ¶æ€è¯„ä¼°

### âœ… å·²å®ŒæˆåŠŸèƒ½

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| å¾®ä¿¡æ¶ˆæ¯ç›‘å¬ | âœ… å®Œæˆ | æ”¯æŒå…¨å±€å…³é”®è¯è¿‡æ»¤ |
| æ¶ˆæ¯å®æ—¶æ¨é€ | âœ… å®Œæˆ | SSE å®æ—¶æ¨é€ |
| AI å›å¤ç”Ÿæˆ | âœ… å®Œæˆ | æ”¯æŒ 3 ç§é£æ ¼ |
| AI ä¸“å®¶é…ç½® | âœ… å®Œæˆ | å‘å¯¼å¼é…ç½® |
| æ¶ˆæ¯å‘é€ | âœ… å®Œæˆ | è‡ªåŠ¨å‘é€ |
| è”ç³»äººè¯»å– | âœ… å®Œæˆ | OCR + UI è‡ªåŠ¨åŒ– |
| å…³é”®è¯è®¾ç½® | âœ… å®Œæˆ | é¦–é¡µå¯é…ç½® |
| AI ä¸“å®¶é€‰æ‹© | âœ… å®Œæˆ | ä¸‹æ‹‰èœå•é€‰æ‹© |
| ä¸€é”®å¯åŠ¨ | âœ… å®Œæˆ | bat è„šæœ¬ |

### âš ï¸ å¾…ä¼˜åŒ–é¡¹

| é¡¹ç›® | ä¼˜å…ˆçº§ | è¯´æ˜ |
|------|--------|------|
| æ–‡ä»¶æ¸…ç† | é«˜ | å¤§é‡æµ‹è¯•æ–‡ä»¶éœ€è¦æ¸…ç† |
| æ–‡æ¡£æ•´ç† | ä¸­ | æ–‡æ¡£è¿‡å¤šï¼Œéœ€è¦æ•´åˆ |
| é”™è¯¯å¤„ç† | ä¸­ | éƒ¨åˆ†é”™è¯¯æç¤ºä¸å¤Ÿå‹å¥½ |
| UI ä¼˜åŒ– | ä½ | ç•Œé¢å¯ä»¥æ›´ç¾è§‚ |
| æ€§èƒ½ä¼˜åŒ– | ä½ | æ¶ˆæ¯ç›‘å¬å¯ä»¥æ›´é«˜æ•ˆ |

### ğŸ› å·²çŸ¥é—®é¢˜

1. **é…ç½®çƒ­æ›´æ–°**: ä¿®æ”¹å…³é”®è¯åéœ€è¦é‡å¯åç«¯
2. **æ¶ˆæ¯å»é‡**: å¶å°”å¯èƒ½å‡ºç°é‡å¤æ¶ˆæ¯
3. **èº«ä»½åˆ¤å®š**: ç¾¤èŠä¸­çš„èº«ä»½åˆ¤å®šå¯èƒ½ä¸å‡†ç¡®

---

## ğŸ“ æ–‡ä»¶æ¸…ç†å»ºè®®

### å¯åˆ é™¤çš„æ–‡ä»¶ï¼ˆçº¦ 50+ ä¸ªï¼‰

**python/ ç›®å½•ä¸‹çš„æµ‹è¯•æ–‡ä»¶**:
- `debug_*.py` (çº¦ 15 ä¸ª)
- `test_*.py` (çº¦ 8 ä¸ª)
- `*_v2.py`, `*_v3.py` ç­‰ç‰ˆæœ¬æ–‡ä»¶
- å„ç§ `*_reader.py` å®éªŒæ–‡ä»¶

**æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶**:
- å¤§é‡ `.png` æˆªå›¾æ–‡ä»¶
- é‡å¤çš„æ–‡æ¡£æ–‡ä»¶
- æµ‹è¯•è„šæœ¬

### å»ºè®®ä¿ç•™çš„æ ¸å¿ƒæ–‡ä»¶

```
python/
â”œâ”€â”€ api_server.py          # ä¸»æœåŠ¡
â”œâ”€â”€ ai_expert_api.py       # AI API
â”œâ”€â”€ message_listener.py    # æ¶ˆæ¯ç›‘å¬
â”œâ”€â”€ wechat_auto.py         # å¾®ä¿¡è‡ªåŠ¨åŒ–
â””â”€â”€ ai_expert/             # AI ä¸“å®¶æ¨¡å—ï¼ˆæ•´ä¸ªç›®å½•ï¼‰

src/                       # æ•´ä¸ªå‰ç«¯ç›®å½•
config/                    # é…ç½®ç›®å½•
electron/                  # Electron ç›®å½•
```

---

## ğŸš€ å¯åŠ¨æ–¹å¼

### ä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰

```bash
åŒå‡»: start_servers.bat
```

### åœæ­¢æœåŠ¡

```bash
åŒå‡»: stop_servers.bat
```

### è®¿é—®åœ°å€

- å‰ç«¯ç•Œé¢: http://localhost:5173
- åç«¯ API: http://localhost:5000

---

## ğŸ“ æ€»ç»“

### é¡¹ç›®ä¼˜åŠ¿

1. **åŠŸèƒ½å®Œæ•´**: ä»æ¶ˆæ¯ç›‘å¬åˆ° AI å›å¤ï¼Œå½¢æˆå®Œæ•´é—­ç¯
2. **æ¶æ„æ¸…æ™°**: å‰åç«¯åˆ†ç¦»ï¼Œæ¨¡å—åŒ–è®¾è®¡
3. **æ˜“äºæ‰©å±•**: AI ä¸“å®¶æ¨¡å—å¯ä»¥çµæ´»é…ç½®
4. **ç”¨æˆ·å‹å¥½**: å‘å¯¼å¼é…ç½®ï¼Œä¸€é”®å¯åŠ¨

### æ”¹è¿›æ–¹å‘

1. **ä»£ç æ¸…ç†**: åˆ é™¤å¤§é‡æµ‹è¯•å’Œè°ƒè¯•æ–‡ä»¶
2. **æ–‡æ¡£æ•´åˆ**: å°†å¤šä¸ªæ–‡æ¡£åˆå¹¶ä¸ºä¸€ä¸ªå®Œæ•´æŒ‡å—
3. **é…ç½®çƒ­æ›´æ–°**: æ”¯æŒä¸é‡å¯æ›´æ–°é…ç½®
4. **UI ç¾åŒ–**: ç»Ÿä¸€è®¾è®¡é£æ ¼
5. **æµ‹è¯•è¦†ç›–**: æ·»åŠ è‡ªåŠ¨åŒ–æµ‹è¯•

### æŠ€æœ¯å€ºåŠ¡

1. çº¦ 50+ ä¸ªæµ‹è¯•æ–‡ä»¶éœ€è¦æ¸…ç†
2. çº¦ 30+ ä¸ªæ–‡æ¡£æ–‡ä»¶éœ€è¦æ•´åˆ
3. éƒ¨åˆ†ä»£ç æ³¨é‡Šä¸å®Œæ•´
4. é”™è¯¯å¤„ç†ä¸å¤Ÿç»Ÿä¸€

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-01-05
**åˆ†æç‰ˆæœ¬**: v2.0

